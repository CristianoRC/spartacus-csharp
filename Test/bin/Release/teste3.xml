<?xml version="1.0" encoding="UTF-8" ?>
<report>

    <connection>
        <type>odbc</type>
        <provider></provider>
        <host></host>
        <port></port>
        <service>TPMP563</service>
        <user>planning</user>
        <password>plaserv</password>
    </connection>

    <settings>
        <layout>LANDSCAPE</layout>
    
        <topmargin>30,0</topmargin>
        <bottommargin>20,0</bottommargin>
        <leftmargin>30,0</leftmargin>
        <rightmargin>20,0</rightmargin>
    
        <dataheaderborder>TOP,BOTTOM</dataheaderborder>
        <datafieldborder>NONE</datafieldborder>
        <groupheaderborder>NONE</groupheaderborder>
        <groupfooterborder>NONE</groupfooterborder>
        
        <dataheadercolor>WHITE</dataheadercolor>
        <datafieldevencolor>WHITE</datafieldevencolor>
        <datafieldoddcolor>WHITE</datafieldoddcolor>
        <groupheadercolor>LIGHTGRAY</groupheadercolor>
        <groupfootercolor>LIGHTGRAY</groupfootercolor>
        
        <reportheaderfont>
            <family>HELVETICA</family>
            <bold>FALSE</bold>
            <italic>FALSE</italic>
            <size>8,0</size>
        </reportheaderfont>
        
        <reportfooterfont>
            <family>HELVETICA</family>
            <bold>FALSE</bold>
            <italic>FALSE</italic>
            <size>8,0</size>
        </reportfooterfont>
        
        <dataheaderfont>
            <family>HELVETICA</family>
            <bold>FALSE</bold>
            <italic>FALSE</italic>
            <size>8,0</size>
        </dataheaderfont>
        
        <datafieldfont>
            <family>HELVETICA</family>
            <bold>FALSE</bold>
            <italic>FALSE</italic>
            <size>7,0</size>
        </datafieldfont>
        
        <groupheaderfont>
            <family>HELVETICA</family>
            <bold>TRUE</bold>
            <italic>FALSE</italic>
            <size>7,0</size>
        </groupheaderfont>
        
        <groupfooterfont>
            <family>HELVETICA</family>
            <bold>TRUE</bold>
            <italic>FALSE</italic>
            <size>7,0</size>
        </groupfooterfont>
    </settings>

    <command>
        <sql>
            select -- dados do relatorio
                   'Importacoes de Empresas Vinculadas' as titulo,
                   'Por Produto - Analitico' as subtitulo,
                   'ARAG DO BRASIL' as empresa,
                   'Ano: 2013' as ano,
                   'logoarag.png' as imagem,
                   'Usuario: William Ivanski' as usuario,
                   'Sistema: Planner v0.7.0 - Modulo de Relatorios v1' as sistema,
                   'Emissao: ' || to_char(sysdate, 'dd/mm/yyyy hh24:mi:ss') as emissao,
                   -- total geral
                   totalgeral.encustofob as geral_encustofob,
                   totalgeral.enii as geral_enii,
                   totalgeral.enfrete as geral_enfrete,
                   totalgeral.enseguro as geral_enseguro,
                   totalgeral.enaduaneiras as geral_enaduaneiras,
                   totalgeral.encomplementares as geral_encomplementares,
                   totalgeral.encustocif as geral_encustocif,
                   -- total por produto
                   p.prid,
                   'Produto: ' || to_char(p.prid) || ' - ' || p.prdescricao as produto,
                   totalproduto.encustofob as produto_encustofob,
                   totalproduto.enii as produto_enii,
                   totalproduto.enfrete as produto_enfrete,
                   totalproduto.enseguro as produto_enseguro,
                   totalproduto.enaduaneiras as produto_enaduaneiras,
                   totalproduto.encomplementares as produto_encomplementares,
                   totalproduto.encustocif as produto_encustocif,
                   -- detalhe
                   trim(cf.cfid) as cfid,
                   cf.cfrazao as cfrazao,
                   cf.cfpais as cfpais,
                   trim(e.enserie) as enserie,
                   to_char(e.ennf) as ennf,
                   to_char(e.enentrada, 'dd/mm/yyyy') as enentrada,
                   to_char(e.ntid) as ntid,
                   to_char(e.enqtde) as enqtde,
                   trim(e.enun) as enun,
                   to_char(e.encustofob) as encustofob,
                   to_char(e.enii) as enii,
                   to_char(e.enfrete) as enfrete,
                   to_char(e.enseguro) as enseguro,
                   to_char(e.enaduaneiras) as enaduaneiras,
                   to_char(e.encomplementares) as encomplementares,
                   to_char((e.encustofob +
                            e.enii +
                            e.enfrete +
                            e.enseguro +
                            e.enaduaneiras +
                            e.encomplementares)) as encustocif
            from planning.entradas e,
                 planning.produtos p,
                 planning.cfop c,
                 planning.clifor cf,
            (
            select p1.prid,
                   to_char(sum(e1.encustofob)) as encustofob,
                   to_char(sum(e1.enii)) as enii,
                   to_char(sum(e1.enfrete)) as enfrete,
                   to_char(sum(e1.enseguro)) as enseguro,
                   to_char(sum(e1.enaduaneiras)) as enaduaneiras,
                   to_char(sum(e1.encomplementares)) as encomplementares,
                   to_char(sum(e1.encustofob +
                               e1.enii +
                               e1.enfrete +
                               e1.enseguro +
                               e1.enaduaneiras +
                               e1.encomplementares)) as encustocif
            from planning.entradas e1,
                 planning.produtos p1,
                 planning.cfop c1,
                 planning.clifor cf1
            where p1.emid = e1.emid
              and p1.prano = e1.enano
              and p1.prid = e1.prid
              and c1.emid = e1.emid
              and c1.ano = e1.enano
              and c1.ntid = e1.ntid
              and c1.nttrpm = 'S'
              and cf1.emid = e1.emid
              and cf1.cfano = e1.enano
              and cf1.cfid = e1.cfid
              and cf1.cftipo = e1.cftipo
              and cf1.cfgrupo = 'SIM'
              and e1.emid = #EMID#
              and e1.enano = #ANO#
            group by p1.prid
            ) totalproduto,
            (
            select to_char(sum(e2.encustofob)) as encustofob,
                   to_char(sum(e2.enii)) as enii,
                   to_char(sum(e2.enfrete)) as enfrete,
                   to_char(sum(e2.enseguro)) as enseguro,
                   to_char(sum(e2.enaduaneiras)) as enaduaneiras,
                   to_char(sum(e2.encomplementares)) as encomplementares,
                   to_char(sum(e2.encustofob +
                               e2.enii +
                               e2.enfrete +
                               e2.enseguro +
                               e2.enaduaneiras +
                               e2.encomplementares)) as encustocif
            from planning.entradas e2,
                 planning.produtos p2,
                 planning.cfop c2,
                 planning.clifor cf2
            where p2.emid = e2.emid
              and p2.prano = e2.enano
              and p2.prid = e2.prid
              and c2.emid = e2.emid
              and c2.ano = e2.enano
              and c2.ntid = e2.ntid
              and c2.nttrpm = 'S'
              and cf2.emid = e2.emid
              and cf2.cfano = e2.enano
              and cf2.cfid = e2.cfid
              and cf2.cftipo = e2.cftipo
              and cf2.cfgrupo = 'SIM'
              and e2.emid = #EMID#
              and e2.enano = #ANO#
            ) totalgeral
            where p.emid = e.emid
              and p.prano = e.enano
              and p.prid = e.prid
              and c.emid = e.emid
              and c.ano = e.enano
              and c.ntid = e.ntid
              and c.nttrpm = 'S'
              and cf.emid = e.emid
              and cf.cfano = e.enano
              and cf.cfid = e.cfid
              and cf.cftipo = e.cftipo
              and cf.cfgrupo = 'SIM'
              and totalproduto.prid = p.prid
              and e.emid = #EMID#
              and e.enano = #ANO#
        </sql>
        <parameters>
            <parameter>
                <name>EMID</name>
                <type>INTEGER</type>
            </parameter>
            <parameter>
                <name>ANO</name>
                <type>INTEGER</type>
            </parameter>
        </parameters>
    </command>

    <header>
        <height>50,0</height>
        <object>
            <type>IMAGE</type>
            <column>imagem</column>
            <posx>0,0</posx>
            <posy>0,0</posy>
            <align>LEFT</align>
        </object>
        <object>
            <type>TEXT</type>
            <column>empresa</column>
            <posx>180,0</posx>
            <posy>5,0</posy>
            <align>LEFT</align>
        </object>
        <object>
            <type>TEXT</type>
            <column>ano</column>
            <posx>0,0</posx>
            <posy>5,0</posy>
            <align>RIGHT</align>
        </object>
        <object>
            <type>TEXT</type>
            <column>titulo</column>
            <posx>180,0</posx>
            <posy>22,0</posy>
            <align>LEFT</align>
        </object>
        <object>
            <type>TEXT</type>
            <column>emissao</column>
            <posx>0,0</posx>
            <posy>22,0</posy>
            <align>RIGHT</align>
        </object>
        <object>
            <type>TEXT</type>
            <column>subtitulo</column>
            <posx>180,0</posx>
            <posy>40,0</posy>
            <align>LEFT</align>
        </object>
        <object>
            <type>PAGENUMBER</type>
            <column></column>
            <posx>0,0</posx>
            <posy>40,0</posy>
            <align>RIGHT</align>
        </object>
    </header>

    <footer>
        <height>20,0</height>
        <object>
            <type>TEXT</type>
            <column>sistema</column>
            <posx>0,0</posx>
            <posy>15,0</posy>
            <align>LEFT</align>
        </object>
        <object>
            <type>TEXT</type>
            <column>usuario</column>
            <posx>0,0</posx>
            <posy>15,0</posy>
            <align>RIGHT</align>
        </object>
    </footer>

    <fields>
        <field>
            <title>Código</title>
            <column>cfid</column>
            <align>LEFT</align>
            <fill>7</fill>
            <type>STRING</type>
        </field>
        <field>
            <title>Fornecedor</title>
            <column>cfrazao</column>
            <align>LEFT</align>
            <fill>11</fill>
            <type>STRING</type>
        </field>
        <field>
            <title>País</title>
            <column>cfpais</column>
            <align>LEFT</align>
            <fill>8</fill>
            <type>STRING</type>
        </field>
        <field>
            <title>Ser</title>
            <column>enserie</column>
            <align>CENTER</align>
            <fill>3</fill>
            <type>STRING</type>
        </field>
        <field>
            <title>Nota</title>
            <column>ennf</column>
            <align>CENTER</align>
            <fill>4</fill>
            <type>STRING</type>
        </field>
        <field>
            <title>Entrada</title>
            <column>enentrada</column>
            <align>CENTER</align>
            <fill>5</fill>
            <type>STRING</type>
        </field>
        <field>
            <title>Nat.</title>
            <column>ntid</column>
            <align>CENTER</align>
            <fill>3</fill>
            <type>STRING</type>
        </field>
        <field>
            <title>Qtde</title>
            <column>enqtde</column>
            <align>RIGHT</align>
            <fill>7</fill>
            <type>REAL</type>
        </field>
        <field>
            <title>Un.</title>
            <column>enun</column>
            <align>CENTER</align>
            <fill>3</fill>
            <type>STRING</type>
        </field>
        <field>
            <title>Custo FOB</title>
            <column>encustofob</column>
            <align>RIGHT</align>
            <fill>7</fill>
            <type>REAL</type>
        </field>
        <field>
            <title>II</title>
            <column>enii</column>
            <align>RIGHT</align>
            <fill>7</fill>
            <type>REAL</type>
        </field>
        <field>
            <title>Frete</title>
            <column>enfrete</column>
            <align>RIGHT</align>
            <fill>7</fill>
            <type>REAL</type>
        </field>
        <field>
            <title>Seguro</title>
            <column>enseguro</column>
            <align>RIGHT</align>
            <fill>7</fill>
            <type>REAL</type>
        </field>
        <field>
            <title>Aduan.</title>
            <column>enaduaneiras</column>
            <align>RIGHT</align>
            <fill>7</fill>
            <type>REAL</type>
        </field>
        <field>
            <title>Compl.</title>
            <column>encomplementares</column>
            <align>RIGHT</align>
            <fill>7</fill>
            <type>REAL</type>
        </field>
        <field>
            <title>Custo CIF</title>
            <column>encustocif</column>
            <align>RIGHT</align>
            <fill>7</fill>
            <type>REAL</type>
        </field>
    </fields>

    <groups>
        <group>
            <level>0</level>
            <column>prid</column>
            <sort>enentrada asc, ennf asc</sort>
            
            <showheader>TRUE</showheader>
            <headerfields>
                <headerfield>
                    <title></title>
                    <column>produto</column>
                    <align>LEFT</align>
                    <fill>100</fill>
                    <type>STRING</type>
                </headerfield>
            </headerfields>
            
            <showfooter>TRUE</showfooter>
            <footerfields>
                <footerfield>
                    <title></title>
                    <column></column>
                    <align>LEFT</align>
                    <fill>51</fill>
                    <type>STRING</type>
                </footerfield>
                <footerfield>
                    <title>Custo FOB</title>
                    <column>produto_encustofob</column>
                    <align>RIGHT</align>
                    <fill>7</fill>
                    <type>REAL</type>
                </footerfield>
                <footerfield>
                    <title>II</title>
                    <column>produto_enii</column>
                    <align>RIGHT</align>
                    <fill>7</fill>
                    <type>REAL</type>
                </footerfield>
                <footerfield>
                    <title>Frete</title>
                    <column>produto_enfrete</column>
                    <align>RIGHT</align>
                    <fill>7</fill>
                    <type>REAL</type>
                </footerfield>
                <footerfield>
                    <title>Seguro</title>
                    <column>produto_enseguro</column>
                    <align>RIGHT</align>
                    <fill>7</fill>
                    <type>REAL</type>
                </footerfield>
                <footerfield>
                    <title>Aduan.</title>
                    <column>produto_enaduaneiras</column>
                    <align>RIGHT</align>
                    <fill>7</fill>
                    <type>REAL</type>
                </footerfield>
                <footerfield>
                    <title>Compl.</title>
                    <column>produto_encomplementares</column>
                    <align>RIGHT</align>
                    <fill>7</fill>
                    <type>REAL</type>
                </footerfield>
                <footerfield>
                    <title>Custo CIF</title>
                    <column>produto_encustocif</column>
                    <align>RIGHT</align>
                    <fill>7</fill>
                    <type>REAL</type>
                </footerfield>
            </footerfields>
        </group>
        
        <group>
            <level>1</level>
            <column>titulo</column>
            <sort>titulo asc</sort>
            
            <showheader>FALSE</showheader>
            
            <showfooter>TRUE</showfooter>
            <footerfields>
                <footerfield>
                    <title></title>
                    <column></column>
                    <align>LEFT</align>
                    <fill>51</fill>
                    <type>STRING</type>
                </footerfield>
                <footerfield>
                    <title>Custo FOB</title>
                    <column>geral_encustofob</column>
                    <align>RIGHT</align>
                    <fill>7</fill>
                    <type>REAL</type>
                </footerfield>
                <footerfield>
                    <title>II</title>
                    <column>geral_enii</column>
                    <align>RIGHT</align>
                    <fill>7</fill>
                    <type>REAL</type>
                </footerfield>
                <footerfield>
                    <title>Frete</title>
                    <column>geral_enfrete</column>
                    <align>RIGHT</align>
                    <fill>7</fill>
                    <type>REAL</type>
                </footerfield>
                <footerfield>
                    <title>Seguro</title>
                    <column>geral_enseguro</column>
                    <align>RIGHT</align>
                    <fill>7</fill>
                    <type>REAL</type>
                </footerfield>
                <footerfield>
                    <title>Aduan.</title>
                    <column>geral_enaduaneiras</column>
                    <align>RIGHT</align>
                    <fill>7</fill>
                    <type>REAL</type>
                </footerfield>
                <footerfield>
                    <title>Compl.</title>
                    <column>geral_encomplementares</column>
                    <align>RIGHT</align>
                    <fill>7</fill>
                    <type>REAL</type>
                </footerfield>
                <footerfield>
                    <title>Custo CIF</title>
                    <column>geral_encustocif</column>
                    <align>RIGHT</align>
                    <fill>7</fill>
                    <type>REAL</type>
                </footerfield>
            </footerfields>
        </group>
    </groups>

</report>
